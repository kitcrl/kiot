#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <inode.h>
#include <njson.h>
#include <nutil.h>
#include <icode.x.h>

#if defined XWIN32
#include <Windows.h>
#endif

///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
//////                                                                   //////
//////                                                                   //////
//////                          User Function                            //////
//////                                                                   //////
//////                                                                   //////
///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
/*****************************************************************************/
/*****************************************************************************/
/*********************************        ************************************/
/*********************************        ************************************/
/*********************************        ************************************/
/*****************************                ********************************/
/*******************************            **********************************/
/*********************************        ************************************/
/************************************   **************************************/
/************************************* ***************************************/
/*****************************************************************************/
#include <nm.h>
#include <nwsc.h>
#include <ntcp.h>
#include <nhttp.h>
#include <nhttpd.h>


int32_t inode_write(void* h, int32_t fd, int8_t* b, int32_t sz, void* moreinfo, void* o)
{
  int32_t e = 0;

  e = nwsc_Write(b, sz);
  printf("nwsc_Write %08X %s\r\n", e, e>0?"READY":"FAIL");

  return e;
}


///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
//////                                                                   //////
//////                                                                   //////
//////                           Entry Point                             //////
//////                                                                   //////
//////                                                                   //////
///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
/*****************************************************************************/
/*****************************************************************************/
/*********************************        ************************************/
/*********************************        ************************************/
/*********************************        ************************************/
/*****************************                ********************************/
/*******************************            **********************************/
/*********************************        ************************************/
/************************************   **************************************/
/************************************* ***************************************/
/*****************************************************************************/

void* setup(void* arg)
{
  iNode* inode = (iNode*)arg;

  //nhttpd(inode);
  //nhttp(inode);
  nwsc(inode);
  ntcp(inode);

  return 0;
}


void* loop(void* arg)
{
  iNode* inode = (iNode*)arg;

  ntcp_Loop(inode);
  nwsc_Loop(inode);

  return 0;
}



void* main(int32_t argc, int8_t** argv)
{
  static iNode inode;
  memset(&inode, 0, sizeof(iNode));

  inode.argc = argc;
  inode.argv = argv;
  __nmain(argc, argv, setup, loop, &inode);

  return 0;
}
